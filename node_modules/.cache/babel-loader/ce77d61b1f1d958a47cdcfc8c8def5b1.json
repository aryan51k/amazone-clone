{"ast":null,"code":"import _asyncToGenerator from\"/Users/aryan/Desktop/react-amazon/amazon-clone/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/aryan/Desktop/react-amazon/amazon-clone/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/aryan/Desktop/react-amazon/amazon-clone/node_modules/@babel/runtime/regenerator/index.js\";import{CardElement,useElements,useStripe}from'@stripe/react-stripe-js';import React,{useState}from'react';import CurrencyFormat from'react-currency-format';import{Link,Navigate,useNavigate}from'react-router-dom';import CheckoutProduct from'./CheckoutProduct';import'./Payment.css';import axios from'axios';import{useStateValue}from'./StateProvider';import{useEffect}from'react';import{getBasketTotal}from'./reducer';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";function Payment(){var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),_useStateValue2$=_useStateValue2[0],basket=_useStateValue2$.basket,user=_useStateValue2$.user,dispatch=_useStateValue2[1];var stripe=useStripe();var elements=useElements();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),disabled=_useState4[0],setDisabled=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),succeeded=_useState6[0],setSucceeded=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),processing=_useState8[0],setProcessing=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];var navigate=useNavigate();useEffect(function(){var getClientSecret=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:'post',url:\"/payments/create?total=\".concat(getBasketTotal(basket)*100)});case 2:response=_context.sent;setClientSecret(response.data.clientSecret);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref.apply(this,arguments);};}();getClientSecret();},[basket]);console.log(\"Cliet SECRET -->\",clientSecret);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();setProcessing(true);_context2.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}}).then(function(_ref3){var paymentIntent=_ref3.paymentIntent;setSucceeded(true);setError(null);setProcessing(false);navigate('/orders');});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(e){};return/*#__PURE__*/_jsx(\"div\",{className:\"payment\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment__container\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Checkout (\",/*#__PURE__*/_jsxs(Link,{to:\"/checkout\",children:[basket===null||basket===void 0?void 0:basket.length,\" items\"]}),\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Delivery Address\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__address\",children:[/*#__PURE__*/_jsx(\"p\",{children:user===null||user===void 0?void 0:user.email}),/*#__PURE__*/_jsx(\"p\",{children:\"123 React Lane\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Los Angeles, CA\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Review items and delivery\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__items\",children:basket.map(function(item){return/*#__PURE__*/_jsx(CheckoutProduct,{id:item.id,title:item.title,image:item.image,price:item.price,rating:item.rating});})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Payment Method\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__details\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{onChange:handleChange}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__priceContainer\",children:[/*#__PURE__*/_jsx(CurrencyFormat,{renderText:function renderText(value){return/*#__PURE__*/_jsxs(\"h3\",{children:[\"Order Total: \",value]});},decimalScale:2,value:getBasketTotal(basket),displayType:\"text\",thousandSeparator:true,prefix:\"$\"}),/*#__PURE__*/_jsx(\"button\",{disabled:processing||disabled||succeeded,children:/*#__PURE__*/_jsx(\"span\",{children:processing?/*#__PURE__*/_jsx(\"p\",{children:\"Processing\"}):\"Buy Now\"})})]}),error&&/*#__PURE__*/_jsx(\"div\",{children:error})]})})]})]})});}export default Payment;","map":{"version":3,"sources":["/Users/aryan/Desktop/react-amazon/amazon-clone/src/Payment.js"],"names":["CardElement","useElements","useStripe","React","useState","CurrencyFormat","Link","Navigate","useNavigate","CheckoutProduct","axios","useStateValue","useEffect","getBasketTotal","Payment","basket","user","dispatch","stripe","elements","error","setError","disabled","setDisabled","succeeded","setSucceeded","processing","setProcessing","clientSecret","setClientSecret","navigate","getClientSecret","method","url","response","data","console","log","handleSubmit","e","preventDefault","confirmCardPayment","payment_method","card","getElement","then","paymentIntent","payload","handleChange","length","email","map","item","id","title","image","price","rating","value"],"mappings":"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","sourcesContent":["import { CardElement, useElements, useStripe } from '@stripe/react-stripe-js'\nimport React, { useState } from 'react'\nimport CurrencyFormat from 'react-currency-format'\nimport { Link, Navigate, useNavigate } from 'react-router-dom'\nimport CheckoutProduct from './CheckoutProduct'\nimport './Payment.css'\nimport axios from 'axios'\nimport { useStateValue } from './StateProvider'\nimport { useEffect } from 'react'\nimport { getBasketTotal } from './reducer'\nfunction Payment() {\n    const [{basket, user}, dispatch] = useStateValue();\n    const stripe = useStripe();\n    const elements = useElements()\n    const [error, setError] = useState(null);\n    const [disabled, setDisabled] = useState(true);\n    const [succeeded, setSucceeded] = useState(false);\n    const [processing, setProcessing] = useState(\"\");\n    const [clientSecret, setClientSecret] = useState(true);\n    const navigate = useNavigate()\n\n    useEffect(() => {\n        const getClientSecret = async () => {\n            const response = await axios({\n                method: 'post',\n                url: `/payments/create?total=${getBasketTotal(basket) * 100}`\n            })\n            setClientSecret(response.data.clientSecret)\n        }\n        getClientSecret();\n    }, [basket])\n\n    console.log(\"Cliet SECRET -->\",clientSecret)\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        setProcessing(true);\n\n        const payload = await stripe.confirmCardPayment(clientSecret, {payment_method:{\n            card: elements.getElement(CardElement)\n        }\n    }).then(({paymentIntent}) => {\n        setSucceeded(true);\n        setError(null);\n        setProcessing(false)\n\n        navigate('/orders')\n    })\n\n    }\n\n    const handleChange = e => {\n\n    }\n  return (\n    <div className='payment'>\n    <div className='payment__container'>\n        <h1>\n            Checkout (\n                <Link to=\"/checkout\">{basket?.length} items</Link>\n                )\n        </h1>\n\n\n        {/* Payment section - delivery address */}\n        <div className='payment__section'>\n            <div className='payment__title'>\n                <h3>Delivery Address</h3>\n            </div>\n            <div className='payment__address'>\n                <p>{user?.email}</p>\n                <p>123 React Lane</p>\n                <p>Los Angeles, CA</p>\n            </div>\n        </div>\n\n        {/* Payment section - Review Items */}\n        <div className='payment__section'>\n            <div className='payment__title'>\n                <h3>Review items and delivery</h3>\n            </div>\n            <div className='payment__items'>\n                {basket.map(item => (\n                    <CheckoutProduct\n                        id={item.id}\n                        title={item.title}\n                        image={item.image}\n                        price={item.price}\n                        rating={item.rating}\n                    />\n                ))}\n            </div>\n        </div>\n    \n\n        {/* Payment section - Payment method */}\n        <div className='payment__section'>\n            <div className=\"payment__title\">\n                <h3>Payment Method</h3>\n            </div>\n            <div className=\"payment__details\">\n                    {/* Stripe magic will go */}\n\n                    <form onSubmit={handleSubmit}>\n                        <CardElement onChange={handleChange}/>\n\n                        <div className='payment__priceContainer'>\n                            <CurrencyFormat\n                                renderText={(value) => (\n                                    <h3>Order Total: {value}</h3>\n                                )}\n                                decimalScale={2}\n                                value={getBasketTotal(basket)}\n                                displayType={\"text\"}\n                                thousandSeparator={true}\n                                prefix={\"$\"}\n                            />\n                            <button disabled={processing || disabled || succeeded}>\n                                <span>{processing ? <p>Processing</p> : \"Buy Now\"}</span>\n                            </button>\n                        </div>\n\n                          {/* Errors */}\n                        {error && <div>{error}</div>}\n                    </form>\n            </div>\n        </div>\n    </div>\n</div>\n)\n}\n\nexport default Payment"]},"metadata":{},"sourceType":"module"}